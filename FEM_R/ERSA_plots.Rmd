---
title: "ERSA PLOTS"
output: html_notebook
---

```{r "setup", include=FALSE}
# Need to set up the environment
workingDir <- "/home/luke/Documents/E_FEM_clean/E_FEM"
knitr::opts_knit$set(root.dir = workingDir)

require(haven)
require(dplyr)
require(tidyr)
require(ggplot2)
```

# COHORT

```{r}

cohort <- read_dta('output/ELSA_cohort/ELSA_cohort_summary.dta')

colours.mf <- c("Male" = "red", "Female" = "blue")

# Generate age var
cohort$age <- (cohort$year - 2012) + 50

# Survival curve
cohort$survival <- cohort$m_endpop_all / cohort$m_endpop_all[1]
cohort$survivalm <- cohort$m_endpop_m / cohort$m_endpop_m[1]
cohort$survivalf <- cohort$m_endpop_f / cohort$m_endpop_f[1]

cohort_cp <- rename(cohort, Male = survivalm, Female = survivalf)

cohort_gath <- gather(cohort_cp, key = Subpopulation, value = Rate, c("Male", "Female"))
#pop_gathered$Subpopulation <- factor(pop_gathered$Subpopulation, levels = c("Total Population", "No Alcohol", "Light Drinker", "Moderate Drinker", "Heavy Drinker"))
cohort_gath$Subpopulation <- factor(cohort_gath$Subpopulation, levels = c("Female", "Male"))

ggplot(cohort_gath, aes(x=year, y= Rate, group = Subpopulation, colour = Subpopulation)) + 
        geom_line() +
        labs(title='Cohort Survival', 
             y='Survival', 
             x='Year') +
        scale_color_manual(name = "Subpopulation", labels=c("Female", "Male"), values = colours.mf)

# Now plot all survival curves together
ggplot(cohort, aes(x=age, y=survival)) +
        geom_line(col='black', size=0.3) +
        labs(title='Cohort Survival', y='Survival', x='Age')

# Now plot all survival curves together
ggplot(cohort, aes(x=age, y=survival)) +
        geom_line(col='red', size=0.3, aes(y=survivalm)) +
        geom_line(col='blue', size=0.3, aes(y=survivalf)) +
        labs(title='Cohort Survival', y='Survival', x='Age')


```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

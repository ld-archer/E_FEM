-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/ld-archer/Documents/E_FEM/trunk/FEM_Stata/Makedata/ELSA/gene
> rate_stock_pop.log
  log type:  text
 opened on:   9 Dec 2019, 08:51:22

. 
. quietly include ../../../fem_env.do

. 
. local in_file "ELSA_long"

. 
. local out_file : env OUTPUT

. 
. use $outdata/ELSA_long.dta, clear

. *use ../../../input_data/ELSA_long.dta, clear
. 
. * Keep respondents in wave 6
. keep if wave == 6
(67,136 observations deleted)

. gen entry = 2012 /* First wave is 2002 so 6th is 2012 */

. 
. * Make sure no l2smkstat variables are missing (otherwise CrossSectionalModul
> e/summary_output breaks(?))
. replace l2smkstat = smkstat if missing(l2smkstat) & !missing(smkstat)
(0 real changes made)

. codebook l2smkstat

-------------------------------------------------------------------------------
l2smkstat                                                           (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [1,3]                        units:  1
         unique values:  3                        missing .:  424/11,119

            tabulation:  Freq.  Value
                         4,124  1
                         5,111  2
                         1,460  3
                           424  .

. drop if missing(l2smkstat)
(424 observations deleted)

. 
. * Drop the deceased - TO DO: Fix this, as we want deceased in first year of s
> imulation
. drop if died == 1
(263 observations deleted)

. 
. *** KLUDGE ***
. do kludge.do

. /* kludge.do */
. 
. * Kludge section -  these are all variables that will be either eliminated fr
> om the simulation or developed in the data.
. 
. * For earnings
. gen iearnuc = 0

. gen iearnx = 0

. 
. * handle missing work vals
. replace work = 0 if missing(work)
(1 real change made)

. replace l2work = work if missing(l2work)
(1,510 real changes made)

. replace l2work = 0 if missing(l2work)
(0 real changes made)

. 
. * For marital status
. gen married = 0

. gen l2married = married

. gen single = 0

. gen l2single = single

. gen widowed = 0

. gen l2widowed = widowed

. 
. * for nursing home status
. gen nhmliv = 0

. 
. * Race dummies
. gen black = 0

. gen hispan = 0

. 
. * Defined-benefit pension dummy
. gen fanydb = 0

. gen dbclaim = 0

. 
. * for wealth
. gen wlth_nonzero = 0

. gen l2wlth_nonzero = 0

. gen loghatotax = 0

. gen l2loghatotax = 0

. 
. * Disease status prior to starting HRS survey
. foreach var in canc diabe heart hibp lung strok {
  2.                 gen f`var'50 = 0
  3. }

. 
. * Smoking status before starting survey
. gen fsmokev = 0

. gen fsmoken50 = 0

.  
. * Claiming Supplemental Security benefits (US specific)
. gen ssiclaim = 0

. gen l2ssiclaim = 0

. 
. * Claiming Federal Disability benefits (US specific)
. gen diclaim = 0

. gen l2diclaim = 0

. 
. * Claiming Social Security retirement benefits (US specific)
. gen ssclaim = 0

. gen l2ssclaim = 0

. 
. * Property taxes
. gen proptax_nonzero = 0

. gen l2proptax_nonzero = 0

. 
. * Hours cared for grandchildren
. gen gkcarehrs = 0

. gen l2gkcarehrs = 0

. 
. * Capital income
. gen hicap = 0

. gen l2hicap = 0

. gen hicap_nonzero = 0

. gen l2hicap_nonzero = 0

. 
. * Government transfers (US specific)
. gen igxfr_nonzero = 0

. 
. * Another birthyear variable (used in simulation)
. gen frbyr = rbyr

. 
. * Fill in all zeroes here.  This will be imputed in the simulation
. drop if died==1
(0 observations deleted)

. drop if missing(age)
(0 observations deleted)

. gen rbmonth = 7

. 
. * Smoking vars
. replace smoken = 0 if missing(smoken)
(1 real change made)

. replace l2smoken = 0 if missing(l2smoken)
(1,642 real changes made)

. 
. replace smokev = 0 if missing(smokev)
(28 real changes made)

. replace l2smokev = 0 if missing(l2smokev)
(1,528 real changes made)

. 
. * Medicare vars
. gen mcare_pta = 0

. gen mcare_ptb = 0

. gen medicare_elig = 0

. 
. tab smkstat, missing

       smkstat |      Freq.     Percent        Cum.
---------------+-----------------------------------
  Never smoked |      3,953       37.89       37.89
 Former smoker |      5,175       49.61       87.50
Current smoker |      1,304       12.50      100.00
---------------+-----------------------------------
         Total |     10,432      100.00

. tab l2smkstat, missing

  l2smkstat |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      4,068       39.00       39.00
          2 |      4,940       47.35       86.35
          3 |      1,424       13.65      100.00
------------+-----------------------------------
      Total |     10,432      100.00

. 
. * Drop cases if missing smkstat vars
. drop if missing(smkstat) & missing(l2smkstat)
(0 observations deleted)

. 
. tab smkstat, missing

       smkstat |      Freq.     Percent        Cum.
---------------+-----------------------------------
  Never smoked |      3,953       37.89       37.89
 Former smoker |      5,175       49.61       87.50
Current smoker |      1,304       12.50      100.00
---------------+-----------------------------------
         Total |     10,432      100.00

. tab l2smkstat, missing

  l2smkstat |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      4,068       39.00       39.00
          2 |      4,940       47.35       86.35
          3 |      1,424       13.65      100.00
------------+-----------------------------------
      Total |     10,432      100.00

. 
. * Handle health limits work missing values
. * If missing, first try to infer from lagged value (is this a good idea?)
. replace hlthlm = l2hlthlm if missing(hlthlm)
(274 real changes made, 88 to missing)

. replace l2hlthlm = hlthlm if missing(l2hlthlm)
(1,507 real changes made)

. * If still missing, going to assume patient is either not currently 
. * working (so can't say if health limited) or simply is not limited by health
. * THIS COULD BE PROBLEMATIC, NEED TO UNDERSTAND WHY MISSING
. replace hlthlm = 0 if missing(hlthlm)
(278 real changes made)

. replace l2hlthlm = 0 if missing(l2hlthlm)
(278 real changes made)

. 
. replace logbmi = l2logbmi if missing(logbmi)
(0 real changes made)

. replace l2logbmi = logbmi if missing(l2logbmi)
(0 real changes made)

. gen flogbmi50 = l2logbmi

. 
. 
. * Handle missing retemp data
. replace l2retemp = retemp if missing(l2retemp) & !missing(retemp)
(1,509 real changes made)

. replace retemp = l2retemp if missing(retemp) & !missing(l2retemp)
(1 real change made)

. 
. * Handle missing lag asthma data (if asthmae == 1 then l2asthmae must == 1 al
> so)
. replace l2asthmae = asthmae if missing(l2asthmae)
(1,505 real changes made)

. * Handle missing lag parkinson data, same as above
. replace l2parkine = parkine if missing(l2parkine)
(1,505 real changes made)

. 
. *Handle missing drink data
. replace l2drink = drink if missing(l2drink) & !missing(drink)
(1,609 real changes made)

. replace drink = l2drink if missing(drink) & !missing(l2drink)
(760 real changes made)

. ** DO NOT LEAVE THIS LINE IN!! JUST FOR REMOVING AN ERROR, MUST HOTDECK/IMPUT
> E THIS SOON
. replace l2drink = 0 if missing(l2drink)
(842 real changes made)

. ** DO NOT LEAVE!!!
. 
. * Handle missing vgactx_e && mdactx_e data **THIS IS BAD!!!
. replace l2vgactx_e = vgactx_e if missing(l2vgactx_e) & !missing(vgactx_e)
(1,509 real changes made)

. replace vgactx_e = l2vgactx_e if missing(vgactx_e) & !missing(l2vgactx_e)
(1 real change made)

. replace l2mdactx_e = mdactx_e if missing(l2mdactx_e) & !missing(mdactx_e)
(1,508 real changes made)

. replace mdactx_e = l2mdactx_e if missing(mdactx_e) & !missing(l2mdactx_e)
(1 real change made)

. * If still missing, replace with 'hardly ever or never'==5 (for exercise)
. replace vgactx_e = 5 if missing(vgactx_e)
(1 real change made)

. replace l2vgactx_e = 5 if missing(l2vgactx_e)
(1 real change made)

. replace mdactx_e = 5 if missing(mdactx_e)
(1 real change made)

. replace l2mdactx_e = 5 if missing(l2mdactx_e)
(1 real change made)

. 
. * Handle missing modex_reg data
. replace l2modex_reg = modex_reg if missing(l2modex_reg) & !missing(modex_reg)
(1,508 real changes made)

. replace modex_reg = l2modex_reg if missing(modex_reg) & !missing(l2modex_reg)
(1 real change made)

. ** DO NOT LEAVE THIS LINE IN!! JUST FOR REMOVING AN ERROR, MUST HOTDECK THIS 
> SOON
. replace l2modex_reg = 0 if missing(l2modex_reg)
(1 real change made)

. replace modex_reg = 0 if missing(modex_reg)
(1 real change made)

. ** DO NOT LEAVE!!!
. 
end of do-file

. 
. foreach var of varlist cancre diabe hearte hibpe lunge stroke arthre psyche {
  2.     replace `var' = 0 if missing(`var')
  3.     replace l2`var' = 0 if missing(l2`var')
  4. }
(0 real changes made)
(1,505 real changes made)
(0 real changes made)
(1,505 real changes made)
(0 real changes made)
(1,505 real changes made)
(0 real changes made)
(1,505 real changes made)
(0 real changes made)
(1,505 real changes made)
(0 real changes made)
(1,505 real changes made)
(0 real changes made)
(1,505 real changes made)
(0 real changes made)
(1,505 real changes made)

. 
. replace l2age = age - 2 if missing(l2age)
(1,505 real changes made)

. 
. * Save the file
. saveold $outdata/ELSA_stock_base.dta, replace v(12)
(saving in Stata 12 format, which can be read by Stata 11 or 12)
file /home/ld-archer/Documents/E_FEM/trunk/input_data/ELSA_stock_base.dta saved

. *saveold ../../../input_data/ELSA_stock_base.dta, replace v(12)
. 
. 
. *** Now prepare different stock files for different scenarios ***
. 
. * Increase the number of people doing moderate exercise
. * var used is mdactx_e and has 4 levels:
. * >1/week, 1/week, 1-3/month, hardly ever or never
. * We will move 20% of people in 3 lowest bands up 1 level.
. * Create random numbers from uniform distribution RELIC >
. *gen rand_ex = runiform() if inrange(mdactx_e, 3, 5)
. * Reduce mdactx_e by 1 in 30% of people 
. * (i.e. increase exercise level by 1 in 30% of people exercising once a week 
> or less) RELIC <
. * Now just increasing exercise level of everybody by 1. i.e. shift everyone u
> p a band
. replace mdactx_e = mdactx_e - 1 if mdactx_e > 2
(4,102 real changes made)

. *drop rand_ex
. * Save the file
. saveold $outdata/ELSA_stock_exercise1.dta, replace v(12)
(saving in Stata 12 format, which can be read by Stata 11 or 12)
file /home/ld-archer/Documents/E_FEM/trunk/input_data/ELSA_stock_exercise1.dta 
> saved

. *saveold ../../../input_data/ELSA_stock_exercise1.dta, replace v(12)
. 
. 
. use $outdata/ELSA_stock_base.dta, clear

. *use ../../../input_data/ELSA_stock_base.dta, clear
. * Decrease number of people who drink alcohol
. * var is drink, binary
. * Convert 20% of drinkers to non-drinkers
. gen rand_drink = runiform() if drink==1
(2,179 missing values generated)

. * Switch to non-drinkers in 20% of cases
. replace drink = 0 if rand_drink < 0.4
(3,261 real changes made)

. drop rand_drink

. * Save
. saveold $outdata/ELSA_stock_drink.dta, replace v(12)
(saving in Stata 12 format, which can be read by Stata 11 or 12)
file /home/ld-archer/Documents/E_FEM/trunk/input_data/ELSA_stock_drink.dta save
> d

. *saveold ../../../input_data/ELSA_stock_drink.dta, replace v(12)
. 
. 
. use $outdata/ELSA_stock_base.dta, clear

. *use ../../../input_data/ELSA_stock_base.dta, clear
. * Decrease number of days/week people drink alcohol
. * var is drinkd_e, has 8 levels
. * Ranges from 0-7, for number of days/week
. * Reduce every person by 1 (except 0 for obvious reasons)
. replace drinkd_e = drinkd_e - 1 if drinkd_e > 0
(6,714 real changes made)

. saveold $outdata/ELSA_stock_drinkd_e.dta, replace v(12)
(saving in Stata 12 format, which can be read by Stata 11 or 12)
file /home/ld-archer/Documents/E_FEM/trunk/input_data/ELSA_stock_drinkd_e.dta s
> aved

. *saveold ../../../input_data/ELSA_stock_drinkd_e.dta, replace v(12)
. 
. 
. use $outdata/ELSA_stock_base.dta, clear

. *use ../../../input_data/ELSA_stock_base.dta, clear
. * Decrease number of people who smoke at start of sim by 30%
. gen rand_smoken = runiform() if smoken==1
(9,128 missing values generated)

. replace smoken=0 if rand_smoken < 0.3
(380 real changes made)

. drop rand_smoken

. saveold $outdata/ELSA_stock_smoken.dta, replace v(12)
(saving in Stata 12 format, which can be read by Stata 11 or 12)
file /home/ld-archer/Documents/E_FEM/trunk/input_data/ELSA_stock_smoken.dta sav
> ed

. *saveold ../../../input_data/ELSA_stock_smoken.dta, replace v(12)
. 
. capture log close
